#!/bin/bash

# Update package list and install Nginx
sudo apt update && sudo apt install -y nginx

# Ensure Nginx is enabled and started
sudo systemctl enable nginx
sudo systemctl start nginx

# Check and fix Nginx configuration
if ! grep -q "listen 80;" /etc/nginx/sites-enabled/default; then
  sudo sed -i '/server {/a \ \ \ \ listen 80;' /etc/nginx/sites-enabled/default
fi

# Create a default HTML page
if [ ! -f /var/www/html/index.html ]; then
  echo "<!DOCTYPE html><html><head><title>Welcome to Nginx</title></head><body><h1>It works!</h1></body></html>" | sudo tee /var/www/html/index.html
fi

# Set correct permissions for the web directory
sudo chown -R www-data:www-data /var/www/html
sudo chmod -R 755 /var/www/html

# Reload Nginx to apply changes
sudo nginx -t && sudo systemctl reload nginx

# Open port 80 in the firewall
sudo ufw allow 80/tcp

# Verify Nginx is listening on port 80 and serving the default page
if curl -s http://localhost | grep -q "It works!"; then
  echo "Nginx is configured correctly and serving the default page."
else
  echo "Failed to configure Nginx to serve the default page."
fi

